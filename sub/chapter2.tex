\chapter{主張}\label{chapter:Prepare}
\section{章の概略}\label{section:Outline}
この章では準備としてペンシルパズルに関わる用語の定義を行う. ただし, ペンシルパズルとは「サイズ$m\times n$の平面グリッドを与えたとき, パズルルールに定められた条件と, その解答ステップにおいて明らかになっている解から格子点, 細胞, 辺のいずれかの未知情報に論理的推測から解を書き込み, 全ての格子点, 細胞, 辺がパズルルールに定められた条件を満たす完成盤面へと解く行為と, その問題やルールなどを一括りに呼ぶ概念」とし, 明確な定義は行わずあくまで概念として以下もペンシルパズルという用語を使用する. ただし, 格子点, 細胞, 辺というのは\cref{fig:Board}で与える図中の名前とそれぞれ対応させるものとする.
ペンシルパズルは, 例としてナンバープレイス（\cref{fig:SamplePuzzle}）などが与えられる.
\cref{section:WordDefinition}ではペンシルパズルで与えられる盤面と, それに付随する用語を定義する.
\cref{section:MathematicalDefinition}ではペンシルパズルにおける, 諸概念の数学的な定義を行う.
\cref{section:RelationDefinition}では\cref{section:MathematicalDefinition}で定義する変数同士の関係性についての定義を行う.
\cref{section:GraphDefinition}ではペンシルパズルにおいて考えられるグラフという概念の定義を行う.

\section{用語の定義}\label{section:WordDefinition}
この節ではペンシルパズルにおける用語を定義する.
以下の説明のために位置, 状態, 盤面, 完成盤面, 未完成盤面を簡単に定義する. \cref{fig:Board}で与えたようなグリッドに対し, 前文で述べた格子点, 細胞, 辺を\textbf{位置}と呼ぶこととする. ペンシルパズルにおいて, その位置に与えられる状態のことを本研究ではそのまま\textbf{状態}と呼ぶこととする. 状態とは, 位置に対応する写像で送った結果のことを指し, 未知である状態のことを特に\textit{null}と表現し, 既知である状態のときは具体的に数値や定数で与えられるものとする. 位置の状態が既知である場合, その具体的な数値や定数のことを\textbf{解}と呼ぶこととする. ここで, グリッドにおける各格子点, 細胞, 辺全てに状態が存在するものを総称して\textbf{盤面}と定義する. しかし, その状態が未知, 既知に関わらず盤面と呼ぶことに注意する. \cref{fig:SamplePuzzle}に与えたパズルでは, 左上端の細胞の状態が既知であり, その解は2に対応し, 右下端の細胞の状態は未知である（既知の場合解は3）.
% TODO: 文献挿入

ここでパズルルールを既存のパズルルールと相違ない定義を行うためにパズルルールにて満たされるべき条件を定義する. 既存のパズルルールにおいてあるパズルルールの問題が存在したとき, それが唯一解であることが条件としてにある. 具体的なパズルルールにおいても唯一解であることが条件としてで確認されている. そのため, 本研究においてもパズルの問題, と呼んだときはそれが唯一解であることを要求することとする. ただしここで呼ぶ唯一解とは, 先の解とは意味が異なり, 問題を解いたとき, 盤面として答えが一つに定まるそのことを\textbf{唯一解}と呼ぶことに注意する.
以上のことを踏まえ, 全ての格子点, 細胞, 辺の解がパズルルールに定められた条件（\textit{conditions}）を満たしている盤面のことを\textbf{完成盤面}と定義する. さらに任意の格子点, 細胞, 辺の解が未知であるものが存在する盤面の中で, 全ての位置の状態が既知であるときにパズルルールに定められた条件（\textit{conditions}）に従う完成盤面がただ一つしかない盤面を\textbf{未完成盤面}と定義する. 未完成盤面と完成盤面の例として\cref{fig:SamplePuzzle}を与える. 図中左が未完成盤面, 図中右が完成盤面である.



上の記述より, 一つの完成盤面には複数の未完成盤面が対応する（一つの操作（状態が未知である位置に対し具体的な解を対応させること）を課した未完成盤面もまた未完成盤面. ）.このとき, その複数の未完成盤面と, 完成盤面の集合全体をパズルルールの\textbf{問題}と定義する.

以上のような定義を行うことで問題とは唯一解であることを保証する.



\section{盤面に関する数学的定義}\label{section:MathematicalDefinition}
この節では前節で与えた用語を数学的に定義する. ここで定義するものは全て直感的な定義と違わないように行う.
平面グリッドを与えたとき, ペンシルパズルの盤面には左上から各格子点に対し座標$(i,j)$を割り振ることができる（\cref{fig:Coordinate}）. そうしたとき, グリッドにおける格子点, 細胞, 辺に対して\cref{fig:VariableAtBoard}で表されるように変数を与えることができる.
これをそれぞれ数学的に格子点$p(i,j)$, 細胞$c(i,j)$, 横辺$h(i,j)$, 縦辺$v(i,j)$として定義する.


\begin{definition}[格子点$p(i,j)$, 細胞$c(i,j)$, 横辺$h(i,j)$, 縦辺$v(i,j)$]\label{definition:VariableAtBoard}
  \textbf{格子点}$p(i,j)$($(i,j)\in \mathbb{Z}^2$)を
  \begin{equation*}
    p(i,j)\coloneqq \{(i,j)\} \quad (1\leq i \leq m+1, 1\leq j \leq n+1)
  \end{equation*}
  と定義する.

  以下同様に\textbf{細胞}$c(i,j)$, \textbf{横辺}$h(i,j)$, \textbf{縦辺}$v(i,j)$を
  \begin{align*}
     & c(i,j)\coloneqq  \{(i,j), (i,j+1), (i+1,j), (i+1,j+1)\}  \quad & (1\leq i \leq m, 1\leq j \leq n)   \\
     & h(i,j)\coloneqq  \{(i,j), (i,j+1)\}                      \quad & (1\leq i \leq m, 1\leq j \leq n+1) \\
     & v(i,j)\coloneqq  \{(i,j), (i+1,j)\}                      \quad & (1\leq i \leq m+1, 1\leq j \leq n)
  \end{align*}
  と定義する.

  ただし, $h(i,j),v(i,j)$の詳細に興味がない場合は, 任意の辺という意味で辺$e(i_y,j_y,y)$を
  \begin{equation*}
    e(i_y,j_y,y) \coloneqq \{h(i_h,j_h), v(i_v,j_v)\}\ni \forall x \quad (y \in \{h,v\})
  \end{equation*}
  と定義する.
  ただし, $y=h$のとき$e(i_h,j_h,h)$は横辺$h(i_h,j_h)$, $y=v$のとき$e(i_v,j_v,v)$は縦辺$v(i_v,j_v)$を指すものとする. $(i_y,j_y)$の範囲は$y$によって指定されるそれぞれの変数によって定義されるものとする（$y=h$のときは$1\leq i_h \leq n-1,1\leq j_h \leq n$）.

  また, 格子点, 細胞, 辺の集合の詳細そのものに興味がない場合は任意の格子点, 細胞, 辺という意味で位置$\lambda(i_y,j_y,y)$を
  \begin{equation*}
    \lambda(i_y,j_y,y) \coloneqq \{p(i_p,j_p),c(i_c,j_c),h(i_h,j_h),v(i_v,j_v)\}\ni \forall x \quad (y \in \{p,c,h,v\})
  \end{equation*}
  と定義する.ただし, $y=p$のときは$\lambda(i_p,j_p,p)$は格子点$p(i_p,j_p$), $y=c$のときは$\lambda(i_c,j_c,c)$は細胞$c(i_c,j_c)$, $y=h$のときは$\lambda(i,j,h)$は横辺$h(i_h,j_h)$, $y=v$のときは$\lambda(i,j,v)$は縦辺$v(i_v,j_v)$を指すものとする. $(i_y,j_y)$の範囲は$y$によって指定されるそれぞれの変数によって定義されるものとする（$y=p$のときは$1\leq i_p \leq n,1\leq j_p \leq n$）.
\end{definition}
これら添え字付きの変数を改めて格子点, 細胞, 辺と呼び, これらをまとめた総称として\textbf{位置}と呼ぶこととする.



ペンシルパズルにおいて, 位置に対応させる概念として\textbf{状態}が存在し, これを定義する. ソルバーにある特定の位置に対し具体的な数値や定数が与えられている状態を\textbf{既知}と呼び, その具体的な数値や定数を\textbf{解}と呼ぶ. 既知でない状態のことを\textbf{未知}と呼び, その状態のことを特別に\textit{null}と表現する.
以上から, パズルルールを定義するためには状態がどのような集合の元であるかを定義する必要がある. そのために以下で\textit{codomain}という用語を用いて状態の集合を定義する.

\begin{definition}[\textit{codomain}]\label{definition:Codomain}
  位置に対し一対一に対応する状態がとりうる集合のことを\textbf{\textit{codomain}}と定義する. 格子点, 細胞, 辺の\textit{codomain}を表す集合として$\mathbb{P},\mathbb{C},\mathbb{H},\mathbb{V}$を用いる. $\mathbb{H},\mathbb{V}$の\textit{codomain}が一致している場合にはまとめて$\mathbb{E}$と記述する. \textit{codomain}の詳細に興味がなく, \textit{codomain}全体を考えるときにはそれら集合を含意するものとして$\Lambda$を使用する.
\end{definition}

ここで, 位置が既知であるとき, それぞれ解として具体的な値（1や3などの数値, あるいは$x_1$などの記号）が対応するがその解は列をなしていて同一の値が含んだ列となることがある.
よって\textit{codomain}と解の列は同一視できないことに注意する. また, パズルルールによっては格子点, 細胞, 辺に状態が与えられない場合があり, そのときに限っては\textit{codomain}は$\emptyset$と記述し, 位置に対応する状態が存在しないことを表すこととする.以下に既存のパズルルールのスリザーリンクを例として用いる. ただし, スリザーリンクのパズルルールは以下のものである. \cite{web:SlitherLink}

\begin{enumerate}
  \item 点と点の間にタテヨコに線を引き, 全体で１つの輪っかを作りましょう.
  \item ４つの点で作られた正方形の中にある数字は, その正方形の辺に引く線の数を表しています. 数字のない正方形には, 何本の線を引くかわかりません.
  \item 線を交差させたり, 枝分かれさせたりしてはいけません.
\end{enumerate}



\begin{example}[スリザーリンクの\textit{codomain}]\label{example:SlitherLinkCodomain}
  スリザーリンクにおいては, \textit{codomain}は以下のように表すことができる. しかし辺が「書かれている」時は1,「書かれていない」時は0に対応させるものとする.
  \begin{align*}
     & \mathbb{P}  =  \emptyset                   \\
     & \mathbb{C}  =  \{\textit{null},0,1,2,3,4\} \\
     & \mathbb{E}  =  \{\textit{null},0,1\}
  \end{align*}
\end{example}



以上のように\textit{codomain}を考えることにより, 位置が含まれる各集合から, \textit{codomain}に送る写像を考えることができる.
\begin{definition}[写像$\bm{p}$, $\bm{c}$, $\bm{h}$, $\bm{v}$]\label{definition:Mapping}
  格子点$p(i,j)$を過不足なくふくむ集合$\{p(i,j)\}$から$\mathbb{P}$に送る写像$\bm{p}$を
  \begin{equation*}
    \begin{array}{rccc}
      \bm{p}\colon & \{p(i,j)\} & \longrightarrow & \mathbb{P} \\
                   & p(i,j)     & \longmapsto     & p_{i,j}
    \end{array}
  \end{equation*}
  と定義し, $p_{i,j}$を格子点$p(i,j)$の状態$p_{i,j}$と呼ぶこととする.
  以下同様に$\bm{c}$, $\bm{h}$, $\bm{v}$を

  \begin{equation*}
    \begin{array}{rccc}
      \bm{c}\colon & \{c(i,j)\} & \longrightarrow & \mathbb{C} \\
                   & c(i,j)     & \longmapsto     & c_{i,j}
    \end{array}
  \end{equation*}
  \begin{equation*}
    \begin{array}{rccc}
      \bm{h}\colon & \{h(i,j)\} & \longrightarrow & \mathbb{H} \\
                   & h(i,j)     & \longmapsto     & h_{i,j}
    \end{array}
  \end{equation*}
  \begin{equation*}
    \begin{array}{rccc}
      \bm{v}\colon & \{v(i,j)\} & \longrightarrow & \mathbb{V} \\
                   & v(i,j)     & \longmapsto     & v_{i,j}
    \end{array}
  \end{equation*}
  と定義し, それぞれ状態$c_{i,j}$, $h_{i,j}$, $v_{i,j}$と呼ぶこととする.

  ただし, $\bm{h},\bm{v}$の詳細に興味がない場合は, 同様に
  \begin{equation*}
    \begin{array}{rccc}
      \bm{e}\colon & \{e(i_y,j_y,y)\} & \longrightarrow & \mathbb{E}    \\
                   & e(i_y,j_y,y)     & \longmapsto     & e_{i_y,j_y,y}
    \end{array}
  \end{equation*}
  と記述し, 上記の写像の詳細に興味がない場合それらの写像全てを含意するものとして$\bm{\lambda}$を用いて
  \begin{equation*}
    \begin{array}{rccc}
      \bm{\lambda}\colon & \{\lambda(i_y,j_y,y)\} & \longrightarrow & \Lambda             \\
                         & \lambda(i_y,j_y,y)     & \longmapsto     & \lambda_{i_y,j_y,y}
    \end{array}
  \end{equation*}
  と記述する.上と同様に状態$e_{i_y,j_y,y}$, $\lambda_{i_y,j_y,y}$と呼ぶこととする.
\end{definition}
集合論の用語を用いると, 状態の列$(\lambda_{1_{y(1,1)},1_{y(1,1)},y_{(1,1)}}, \lambda_{1_{y(1,2)},2_{y(1,2)},y_{(1,2)}},...)$と写像\\
$\bm{\lambda}\colon \{\lambda(i_y,j_y,y)\} \longrightarrow \Lambda$の間には$\bm{\lambda}(\lambda(i_y,j_y,y))=\lambda_{i_y,j_y,y}$という自然な一対一対応が存在する.
ここで$\{\lambda_{i_y,j_y,y}\}$は$\{\lambda_{1_{y(1,1)},1_{y(1,1)},y_{(1,1)}}, \lambda_{1_{y(1,2)},2_{y(1,2)},y_{(1,2)}},...\}$であり, 写像$\bm{\lambda}$は$\{\lambda(i_y,j_y,y)\}$によって添え字付けられた族である. またこのとき, $\{\lambda(i_y,j_y,y)\}$は添字集合で, 位置$\lambda(i_y,j_y,y)$はこの写像の添字である.

状態が既知である位置とその解との対応は(\cref{definition:Mapping})のように添字によってラベル付けされ, 解同士の関係は（\cref{definition:Codomain}）直後で記述したように実際に取る値の如何に関わらず別物として扱う.
位置と, その解（\cref{definition:Mapping}）との対応が全て分かっているとき, 写像はそれらの取る値を全て列として記述すれば$\bm{\lambda}\Leftrightarrow \{\lambda_{i_y,j_y,y}\}$と同一視することができる.

このような種々の定義を導入することにより, サイズ$m$, $n$と$\mathbb{P},\mathbb{C},\mathbb{E}$を与えたとき任意の盤面を位置とその状態の対応によって定義することができる.
\begin{definition}[盤面\textit{B}]\label{definition:B}
  \textbf{盤面\textit{B}}を以下のように定義する.
  \begin{equation*}
    B\coloneqq \{\bm{p},\bm{c},\bm{e}\}=\Bigl\{\{p_{i,j}\},\{c_{i,j}\},\{e_{i_y,j_y,y}\}\Bigr\}
  \end{equation*}
\end{definition}
ここで, 位置$\lambda(i_y,j_y,y)$が状態$\lambda_{i_y,j_y,y}$と一対一対応することより誤解の恐れがない場合は$\lambda(i_y,j_y,y) \in B  $, $\lambda_{i_y,j_y,y}\in B $と記述する.
このときは$B$は集合として$B=\{\lambda(i_y,j_y,y)\}$を考え, 状態$\lambda_{i_y,j_y,y}$も$\bm{\lambda}$によりBの元として扱うこととする.
ただし前と同様$\{\lambda(i_y,j_y,y)\}$とは$\{\lambda(1,1,y_{(1,1)}), \lambda(1,2,y_{(1,2)}),...\}$を指すものとする.



ここで, 完成盤面と未完成盤面の定義を再度行う（\cref{section:WordDefinition}）.ただし, 完成盤面は全ての位置の状態が既知であることを必要条件としていて, 以下で使用する\textit{conditions}には\textit{null}を認めたものがないことが前提にあることに注意する.
\begin{definition}[完成盤面と\textit{conditions}]\label{definition:Conditions}
  全ての位置の状態が既知である盤面を与えたとき, 解が満たしているべき条件を\textbf{\textit{conditions}}と呼び, これが条件として記述される盤面の集合の元を\textbf{完成盤面}と定義する.
\end{definition}

未完成盤面は\cref{section:WordDefinition}で定義したように, 全ての位置の状態が既知であるときに\textit{conditions}に従う完成盤面がただ一つしかない盤面を\textbf{未完成盤面}と定義する.
以上から完成盤面と, それに対応する未完成盤面全体の和集合を一つの\textbf{問題}と定義する. ただし, 未完成盤面の集合が空集合でない（完成盤面に対応する未完成盤面が一つ以上存在する）ことを問題の条件とする.

ここで盤面（\cref{definition:B}）全体の集合を考えたとき, 以下のように記述される.
\begin{equation}\label{equation:U}
  U=\Bigl\{\{\bm{p},\bm{c},\bm{e}\}_x\Bigr\}=\biggl\{\Bigl\{\{p_{i,j}\}_x,\{c_{i,j}\}_x,\{e_{i_y,j_y,y}\}_x\Bigr\}_x\biggr\} \quad (1\leq x \leq |U|)
\end{equation}
これに\textit{conditions}を条件として与えることで完成盤面全体の集合が下式で与えられる.
\begin{equation}\label{equation:X}
  X=\biggl\{\Bigl\{\{p_{ij}\}_x,\{c_{ij}\}_x,\{e_{i_y,j_y,y}\}_x\Bigr\}_x\mid \rm{\textit{conditions}}\biggr\}
\end{equation}
このように与えることであるパズルルールが存在したとき, 完成盤面は$X$の元であると言え, ベン図として\cref{fig:VennDiagram}のように記述することができる.

\textit{conditions}の具体例は\cref{section:GraphDefinition}で定義するグラフと\cref{definition:Function}で定義する関数を用いる必要があるため, 後の\cref{example:SlitherLinkConditions}で取り上げることとする.

完成盤面においては位置と解が一対一に対応することにより, $\mathbb{E}$が要素として数値のみを持つ場合に限り新たに下記のような関数を導入することができる(\cref{fig:cross}, \cref{fig:cycle}).

\begin{definition}[\textit{cross}, \textit{cycle}]\label{definition:Function}
  \begin{gather*}
    \textit{cross}(p(i,j))\coloneqq h_{i,j-1}+v_{i-1,j}+h_{i,j}+v_{i,j} \\
    \textit{cycle}(c(i,j))\coloneqq h_{i,j}+v_{i,j}+h_{i+1,j}+v_{i,j+1}
  \end{gather*}
\end{definition}


\cref{definition:B}で定義した完成盤面から未完成盤面を生成するために「ソルバーから解を隠す位置」として\textit{HI(Hidden Information)}を定義する.
また, \textbf{隠す}という言葉を\textit{codomain}から\textit{null}を除いた集合$\Lambda'=\Lambda \setminus \textit{null}$から\textit{codomain}への写像$\phi\colon \Lambda' \longrightarrow \Lambda$を解の列に作用させることとして定義する.
ただし, 具体的な生成方法については\cref{example:GenericAlgorithm}で取り上げる.


ここで, パズルルールによっては未知である状態と, 数値あるいは変数がソルバーに同一の状態として示される場合があることに注意する（スリザーリンク（\cref{example:SlitherLinkCodomain}）においては$e_{i_y,j_y,y} = 0$のときと$e_{i_y,j_y,y}=\textit{null}$のとき, ソルバーに同一の状態として伝えられる.）.


\begin{definition}[\textit{HI(Hidden Information)}]\label{definition:HiddenInformation}
  ソルバーから隠す位置の部分集合を\textbf{\textit{HI(Hidden Information)}}と定義する.
  ただし, その部分集合はパズルルールによってそれが一意に定まるものではなく問題に依存するものとし, パズルルールでは$\{c(i,j)\}$と$\{e(i_y,j_y,y)\}$の部分集合といったように隠す集合及び部分集合の情報のみを指定し, 詳細は指定しないものとする.
\end{definition}



具体的なあるパズルルールが存在したとき具体的な問題を与えた際には具体的な\textit{HI}を与えられる. そのとき, 写像$\phi$が具体的に構成することができて,
\begin{equation}\label{equation:Phi}
  \phi=
  \begin{cases}
    {id \quad (\lambda(i_y,j_y,y) \not\in HI)} \\
    {f \quad (\lambda(i_y,j_y,y) \in HI)}
  \end{cases}
\end{equation}

と記述することができる（ただし, $id$は包含写像で, $f$はいかなる元も$null$へ送る写像である. ）.ただし, \cref{equation:Phi}は写像自体を構成していることに注意する.

\begin{example}[スリザーリンクの\textit{HI}]
  \begin{align*}
     & \{c(i,j)\}の部分集合  \\
     & \{e(i_y,j_y,y)\}
  \end{align*}
\end{example}

\begin{remark}\label{remark:HI}
  完成盤面から\textit{HI}を具体的に選び解を隠した盤面は未完成盤面とは限らない.
\end{remark}
なぜなら, 完成盤面から解を隠した盤面は, 全ての位置の状態を既知にしたとき全ての解が\textit{conditions}に従う完成盤面は一つとは限らない（元の完成盤面以外に違う完成盤面が従う可能性がある. ）. よってそれはあくまで盤面であり未完成盤面とはならないことに注意する. つまり完成盤面の存在は問題の存在と同値にならない. しかし, 先行研究より以下が成立する. ここで用いるパズルルールとは一般に用いられるものの意味で用い, 本研究とは関係がないものとする.
\begin{lemma}\label{lemma:CompleteBoard}
  あるペンシルパズルのパズルルールが存在したとき, 完成盤面が一つ存在すればその完成盤面から未完成盤面を任意に生成することができる.
\end{lemma}
\textit{HI}を用いることにより完成盤面から未完成盤面を生成する手法について説明する. \cite{Fujiwara2022}における未完成盤面の生成の具体的なアルゴリズムは以下のものである. 例として\cite{Fujiwara2022}と同様に数独（ナンバープレイス）を用いる. ただし, 数独（ナンバープレイス）のパズルルールは以下のとおりである. \cite{web:Sudoku}

\begin{enumerate}
  \item あいているマスに,  1から9までの数字のどれかを入れます.
  \item タテ列 （9列あります）,  ヨコ列 （9列あります）,  太線で囲まれた3$\times$3のブロック（それぞれ9マスあるブロックが9つあります）のどれにも1から9までの数字が1つずつ入ります.
\end{enumerate}

\begin{example}[遺伝的アルゴリズム]\label{example:GenericAlgorithm}
  \begin{enumerate}
    \item 縦, 列, $3\times3$の部屋に数字の被りがない完成盤面$X$を1つ用意する.
    \item その盤面から, \textit{HI}の具体的な位置を決め, その部分を全て$null$にする.
    \item 2.の盤面は1.の完成盤面を解として含むが, その盤面は未完成盤面と限らない.
    \item ソルバーがその盤面を解き,
          \begin{enumerate}
            \item 唯一解であれば4.は未完成盤面であり, 数独（ナンバープレイス）の問題である.
            \item その盤面に対応する完成盤面が存在しない, あるいは前の子孫より完成盤面が増えたらその盤面を捨てて5.へ進む. （初回ならその盤面を5.へと進める. ）
            \item その盤面に対応する完成盤面が前の子孫より減ったらその盤面を採用して5.へ進む. （初回ならその盤面を5.へと進める. ）
          \end{enumerate}
    \item \textit{HI}の具体的な位置を変えることにより, 別の完成盤面の存在を仮定する. そのような操作を施した別の盤面を用意して4.へ戻る.
  \end{enumerate}
\end{example}

以上より, 以下が成立する.
\begin{theorem}\label{theorem:Equivalent}
  完成盤面の存在は問題の存在と同値である.
\end{theorem}
問題は完成盤面と, 一つ以上の未完成盤面の集合との和集合であった. よって, 完成盤面の存在が未完成盤面の存在を保証することにより\cref{theorem:Equivalent}が成立する.






\section{位置の関係性の定義}\label{section:RelationDefinition}

次に, \cref{section:MathematicalDefinition}で定義した位置同士の関係性について定義を行う. ただし, ここでは完成盤面を仮定する.
まず, 連結, 含有, 隣接, 到達可能の定義を行う.
連結とは直感的に辺と辺が繋がっていることを表す用語とし, 含有とは位置が集合として他の位置を含むこと, 隣接とは細胞と細胞が辺を共有していること, 到達可能とは離れた辺と辺へと向かう道が存在することを表す用語として導入する.

\begin{definition}[連結]\label{definition:Connection}
  辺$e(i_y,j_y,y)$と辺$e(i_{y'}',j_{y'}',y')$が\textbf{連結}であるとは, 以下が成立することで定義する.
  \begin{equation*}
    \begin{cases}
      {e_{i_y,j_y,y}=1,\quad e_{i_{y'}',j_{y'}',y'}  =     1          } \\
      {e(i_y,j_y,y)\cap e(i_{y'}',j_{y'}',y')  \neq  \emptyset}
    \end{cases}
  \end{equation*}
\end{definition}

\begin{definition}[含有]\label{definition:Contain}
  辺$e(i_y,j_y,y)$が格子点$p(i',j')$を\textbf{含む（含有する）}とは以下が成立することで定義する.
  \begin{equation*}
    \begin{cases}
      {e_{i_y,j_y,y}=1               } \\
      {e(i_y,j_y,y)\supset p(i',j')}
    \end{cases}
  \end{equation*}
  以下同様に, 細胞$c(i,j)$が辺$e(i_{y'}',j_{y'}',y')$を含む, 細胞$c(i,j)$が格子点$p(i',j')$を含むことを以下が成立することでそれぞれ定義する.
  \begin{equation*}
    \begin{cases}
      {e_{i_{y'}',j_{y'}',y'}=1 } \\
      {c(i,j)\supset e(i_{y'}',j_{y'}',y')}
    \end{cases}
  \end{equation*}
  \begin{align*}
    c(i,j)\supset p(i',j')
  \end{align*}
\end{definition}
このような含有の概念を考えることで細胞, 辺が持つ集合を考えることができるので, これを以下で定義する. ただし, $c(i,j)\supset e(i_{y'}',j_{y'}',y')$などと記述する場合には$c(i,j)$に含まれる$e(i_y,j_y,y)$という意味で用いる.
\begin{definition}[$P_{c(i,j)}$, $E_{c(i,j)}$, $P_{e(i_y,j_y,y)}$]
  細胞$c(i,j)$が含む格子点の集合$P_{c(i,j)}$, 細胞$c(i,j)$が含む辺の集合$E_{c(i,j)}$, 辺$e(i_y,j_y,y)$が含む格子点の集合$P_{e(i_y,j_y,y)}$を以下で定義する.
  \begin{align*}
    P_{c(i,j)}       & \coloneqq \{p(i',j') \mid \forall p(i',j') \subset c(i,j)\}                           \\
    E_{c(i,j)}       & \coloneqq \{e(i_{y'}',j_{y'}',y') \mid \forall e(i_{y'}',j_{y'}',y') \subset c(i,j)\} \\
    P_{e(i_y,j_y,y)} & \coloneqq \{p(i',j') \mid \forall p(i',j') \subset e(i_y,j_y,y)\}
  \end{align*}
\end{definition}


\begin{definition}[隣接]\label{definition:Adjacent}
  細胞$c(i,j)$と細胞$c'(i,j)$が\textbf{隣接する}であるとは以下が成立することで定義する.
  \begin{equation*}
    E_{c(i,j)} \cap E_{c(i',j')} \neq \emptyset
  \end{equation*}
\end{definition}


\begin{definition}[到達可能]
  $e(i_y,j_y,y)$と連結な$e(i_{y_1},j_{y_1},y_1)$, $e(i_{y_1},j_{y_1},y_1)$と連結な$e(i_{y_2},j_{y_2},y_2),...,e(i_{y_t},j_{y_t},y_t)$と連結な$e(i_{y'}',j_{y'}',y')$のような集合\\
  $\{e(i_{y_1},j_{y_1},y_1),e(i_{y_2},j_{y_2},y_2),...,e(i_{y_t},j_{y_t},y_t)\}$がただ一つでも存在するとき, $e(i_y,j_y,y)$から$e(i_{y'}',j_{y'}',y')$に\textbf{辿ることが出来る（到達可能である）}と定義する. ただし, 自分自身は常に辿ることが出来るものとする.
\end{definition}

\begin{remark}
  $e(i_y,j_y,y)$から$e(i_{y'}',j_{y'}',y')$に辿ることが出来る（到達可能である）ときはいつでも$e(i_{y'}',j_{y'}',y')$から$e(i_y,j_y,y)$に辿ることが出来る.
\end{remark}

\begin{example}[連結, 含有, 隣接, 到達可能]
  \cref{fig:SamplePuzzle}において, $h(4,1)$と$v(1,4)$は連結であり, $c(3,4)$は$v(4,4)$のみを含み, $c(2,2)$と$c(2,3)$は隣接しており, $h(3,8)$から$v(8,1)$へは辿ることが出来る.
\end{example}
以上の定義を用いることによって, 新たに「線」という概念を導入することができる.

\begin{definition}[線]\label{definition:Line}
  集合$L$の全ての要素から任意の2つの元を取り出したとき, いつでもそれらが互いに辿ることができるとき集合$L$を\textbf{線}であると定義する.
\end{definition}
この線はグラフ理論の用語を用いるたときの連結グラフとほとんど同義である. \cref{fig:SamplePuzzle}において, 集合$\{h(3,2),v(4,1),h(4,1),h(5,1)\}$は線である. この線も含有という関係性を定義することができて,
\begin{definition}[線の含有]
  線$L$が線$L'$を含むとは以下が成立することで定義する.
  \begin{equation*}
    L\supset L'
  \end{equation*}
  同様に線$L$が辺$e(i_y,j_y,y)$, 格子点$p(i,j)$が含むことを以下が成立することでそれぞれ定義する.
  \begin{equation*}
    \begin{cases}
      {L\supset  e(i_y,j_y,y) } \\
      {L\ni \exists e(i_y,j_y,y) \quad \mbox{s.t. $e(i_y,j_y,y)$が$p(i,j)$を含む}}
    \end{cases}
  \end{equation*}
\end{definition}

\section{グラフ}\label{section:GraphDefinition}
\cref{section:RelationDefinition}で定義した概念を用いることによって, 盤面$B=\Bigl\{\{p_{i,j}\},\{c_{i,j}\},\{e_{i_y,j_y,y}\}\Bigr\}$を与えたとき, 盤面上にグラフという概念を導入することができる.

\begin{definition}[グラフ]\label{definition:GraphDefinition}
  グラフ$G_z$を以下で定義する.
  \begin{equation*}
    G_z=\{P_z,L_z\}=\biggl\{  \Bigl\{p(i,j)\Bigr\}_z,\Bigl\{e(i_y,j_y,y)\Bigr\}_z\biggr\}
  \end{equation*}
  ただし, $L_z$はある$e(i_y,j_y,y)$が存在したとき盤面上に存在する$e(i_y,j_y,y)$を含む線の中で集合として最大の線であり, $P_z$は$L_z$が含む全ての$p(i,j)$の和集合とする. ただし, どの線にも含まれない$p(i,j)$もグラフと呼び, そのときに限り$G_z=\{p(i,j)\}$とし, \textbf{孤立点}と呼ぶこととする（$\{p(i,j)\}$は集合として, 一つの要素$p(i,j)$しか持たない集合）.
\end{definition}

このようなグラフという概念が盤面に存在すると考えられ, 盤面上のグラフ全てを要素に持つ集合
\begin{equation*}
  A=\{G_1,G_2,...,G_m\}=\{G_z\}\quad (mは盤面に存在するグラフの数)
\end{equation*}
がいつでも一意に定まる. （\cref{subsection:GraphIsUniqueProof}）

また, \cref{definition:Function}で取り上げた関数のうち, グラフが定義に$p(i,j)$を含むことにより$\textit{cross}$に関して「グラフ内の全ての$p(i,j)$において, $\textit{cross}(p(i,j))=2$」などという条件を構成できる. グラフという概念を導入したことにより, \cref{definition:Conditions}で取り上げた\textit{conditions}を記述することができる.
\begin{example}\textup{スリザーリンクの\textit{conditions}}\label{example:SlitherLinkConditions}
  \begin{equation*}
    \begin{cases}
      {B\in \forall p(i,j)   , \forall c_{i,j} , \textit{cross}(p(i,j))=c_{i,j} } \\
      {G_1\in \forall p(i,j)            , \textit{cross}(p(i,j))=2       }        \\
      {G_xは孤立点(x\geq 2)}
    \end{cases}
  \end{equation*}
\end{example}

\section{パズルルールの定義}
今章で定義した概念を用いることによってパズルルールを数学的に定義する. パズルルールに必要とされる条件は\cref{section:WordDefinition}より, 問題が一つ以上存在することである. しかし, \cref{theorem:Equivalent}より, 完成盤面の存在は問題の存在と同値である. よって以下のようにペンシルパズルのパズルルールを定義することができる.
\begin{definition}[パズルルール]\label{definition:PuzzleRule}
  具体的な\textit{codomain}と\textit{conditions}と\textit{HI}を与えた際に完成盤面が一つ以上存在するそれらの組み合わせのことを\textbf{パズルルール}と定義する.
\end{definition}
この定義が既存のパズルルールと相違なく定義できていることを確認し, 新しくパズルルールが考えられることを\cref{chapter:3}で実証する.

\section{変換盤面}\label{section:ConvertedBoard}
\cref{definition:B}のような盤面を考えたとき, 格子点に状態が存在しない場合に限り盤面の格子点と細胞の役割を入れ替える操作を考えることができる. 具体的な構成方法は後の\cref{definition:ConvertedBoard}で触れるが, 格子点$p(i,j)\mapsto$細胞$c'(i,j)$, 細胞$c(i,j)\mapsto$格子点$p'(i+1,j+1)$へと変換することができる. 辺$e(i_y,j_y,y)$に関しては, その辺をまたがないように変換後は辺を構成することで新たに盤面を記述することができる. これらの変換は一対一写像であり, 逆写像も存在することにより同一の盤面として扱うことができる. このような変換を本研究では\textbf{シフト}, \textbf{逆シフト}と呼び, これを以下で定義する.
\begin{definition}[シフト, 逆シフト]\label{definition:ConvertedBoard}
  盤面$B$を与えられたとき, 格子点が状態を持たないとき以下の変換を考えることができる.
  \begin{align*}
    \bm{f_p}\colon & p(i,j)  \longmapsto c'(i,j)     \\
    \bm{f_c}\colon & c(i,j)  \longmapsto p'(i+1,j+1)
  \end{align*}
  それぞれの位置に対応する状態も, 変換後の位置に対応させるものとする. また, 辺に関しても以下の変換を行うことにより, ある盤面を新たな盤面へと変換させることができる.
  \begin{align*}
    \bm{f_h}\colon & h(i,j)  \longmapsto v'(i,j+1) \\
    \bm{f_v}\colon & v(i,j)  \longmapsto h'(i+1,j)
  \end{align*}
  ただし, 辺に関しては状態を反転させるものとする. （e.g. $h_{3,4}=1$のとき, $v'_{3,5}=0$）また, $h'_{1,n'}$, $h'_{m+2,n'}$, $v'_{m',1}$, $v'_{m',n+2}$は全て値として1を取り, $p'_{1,n'}$, $p'_{m+2,n'}$, $p'_{m',1}$, $p'_{m',n+2}$は状態を考えないものとする. $(1\leq m' \leq m+1, \quad 1\leq n'\leq n+1)$

  このような変換をいかなる盤面でも考えることができ、さらに
\end{definition}




\begin{clearpagefigure}
  \includegraphics[width=8cm,clip]{fig/board.png}
  \caption{}
  \label{fig:Board}
\end{clearpagefigure}

\begin{clearpagefigure}
  \includegraphics[width=8cm,clip]{fig/samplePuzzle.png}
  \caption{}
  \label{fig:SamplePuzzle}
\end{clearpagefigure}

\begin{clearpagefigure}
  \includegraphics[width=8cm,clip]{fig/coordinate.png}
  \caption{}
  \label{fig:Coordinate}
\end{clearpagefigure}

\begin{clearpagefigure}
  \includegraphics[width=8cm,clip]{fig/define.png}
  \caption{}
  \label{fig:VariableAtBoard}
\end{clearpagefigure}

\begin{clearpagefigure}
  \includegraphics[width=5cm]{fig/slitherlink.png}
  \caption{スリザーリンクの完成盤面}
\end{clearpagefigure}

\begin{clearpagefigure}
  \includegraphics[width=8cm,clip]{fig/vennDiagram.png}
  \caption{}
  \label{fig:VennDiagram}
\end{clearpagefigure}

\begin{clearpagefigure}
  \includegraphics[width=5cm]{fig/cross.png}
  \caption{cross}
  \label{fig:cross}
\end{clearpagefigure}

\begin{clearpagefigure}
  \includegraphics[width=5cm]{fig/cycle.png}
  \caption{cycle}
  \label{fig:cycle}
\end{clearpagefigure}
