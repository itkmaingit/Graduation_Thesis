\chapter{準備}
\section{ペンシルパズルに関する諸概念の定義}
\subsection{用語の定義}
この節ではペンシルパズルにおける用語を定義する．

ただし，ペンシルパズルとは「サイズ$m\times n$の平面グリッドが盤面として与えられ，パズルルールに定められた条件とその解答ステップにおいて存在する既知情報から格子点，細胞，辺のいずれかの未知情報に論理的推測から解を書き込み，全ての格子点，細胞，辺がパズルルールに定められた条件を満たす完成盤面へと解く行為と，その問題を一括りに呼ぶための概念」とする．

ここで，ペンシルパズルにおいて具体的なパズルルールを与えた際に，そのパズルルールに則った問題を考えることができる．その問題にかかわる概念として完成盤面と未完成盤面の定義を行う．

\begin{definition}\label{definition:FinishedBoard}\textup{\textgt{完成盤面}}

  全ての格子点，細胞，辺がパズルルールに定められた条件を満たしている盤面
\end{definition}

\begin{definition}\label{definition:UnfinishedBoard}\textup{\textgt{未完成盤面}}

  各未知情報がその未完成盤面に対応する完成盤面の解と一対一に対応するような盤面．(\textgt{唯一解})
\end{definition}
\vskip\baselineskip

上の記述より，一つの完成盤面には複数の未完成盤面が対応する．(一つの操作(未知情報に解を書き込む)を課した未完成盤面もまた未完成盤面である．)

つまり，未完成盤面から完成盤面への写像が(そのパズルルールに対し)ただ一つ存在すれば，その未完成盤面の集合全体は与えたパズルルールの「問題である」と言える．

\subsection{盤面の定義}
この節ではペンシルパズルの盤面上の情報に関する各概念を数学的に定義する．


平面グリッドを与えたとき，ペンシルパズルの盤面には左上から各格子点に対し座標$(i,j)$を割り振ることができる．そうした時，グリッドにおける格子点，細胞，辺に対して下図で表されるように変数を与えることができるが，これを数学的に定義する．各格子点，辺，細胞を構成する各座標の集合をそれぞれ
\begin{definition}\label{definition:VariableAtBoard}\textup{\textgt{盤面上の変数}}
  \begin{align}
    p(i,j)\coloneqq & \{(i,j)\}                              & \\
    c(i,j)\coloneqq & \{(i,j), (i,j+1), (i+1,j), (i+1,j+1)\} & \\
    h(i,j)\coloneqq & \{(i,j), (i,j+1)\}                     & \\
    v(i,j)\coloneqq & \{(i,j), (i+1,j)\}                     &
  \end{align}
\end{definition}
\vskip\baselineskip
と定義する．このような添え字付きの変数を改めて格子点，細胞，辺とし，まとめて盤面上の変数と呼ぶこととする．

ペンシルパズルにおいて，盤面上の変数に対して，ソルバーは解を対応させることが前提にあるので，パズルルールを定義するためには，解がどのような集合の元に含まれるかを定義していなければならない．

\begin{definition}\label{definition:Codomain}\textup{\textbf{codomain}}

  盤面上の変数に対応する解がとりうる値の集合
\end{definition}

\vskip\baselineskip
以下に既存のパズルルールのスリザーリンクを例として用いる．ただし，スリザーリンクのパズルルールは以下のものである．\cite{web:SlitherLink}

\begin{enumerate}
  \item 点と点の間にタテヨコに線を引き，全体で１つの輪っかを作りましょう．
  \item ４つの点で作られた正方形の中にある数字は，その正方形の辺に引く線の数を表しています．数字のない正方形には，何本の線を引くかわかりません．
  \item 線を交差させたり，枝分かれさせたりしてはいけません．
\end{enumerate}




\begin{example}\label{example:SlitherLinkCodomain}\textup{スリザーリンクのcodomain}

  スリザーリンクにおいては，codomainは以下のように表すことができる．しかし辺が「書かれている」時は1,「書かれていない」時は0に対応させるものとする．
  \begin{align*}
    \mathbb{P} = & \{null\}      & \\
    \mathbb{C} = & \{0,1,2,3,4\} & \\
    \mathbb{H} = & \{0,1\}       & \\
    \mathbb{V} = & \{0,1\}       &
  \end{align*}
\end{example}
\vskip\baselineskip

このようにcodomainを考えることにより，盤面上の変数の各集合から，codomainの元を与える写像を考えることができる．

\begin{definition}\label{definition:Mapping}\textup{盤面上の変数に解を対応させる写像}

  \begin{equation}
    \begin{array}{rccc}
      \bm{p}\colon & \{p(i,j)\}            & \longrightarrow & \mathbb{P}            \\
                   & \rotatebox{90}{$\in$} &                 & \rotatebox{90}{$\in$} \\
                   & p(i,j)                & \longmapsto     & p_{i,j}
    \end{array}
  \end{equation}
  \vskip\baselineskip

  \begin{equation}
    \begin{array}{rccc}
      \bm{c}\colon & \{c(i,j)\}            & \longrightarrow & \mathbb{C}            \\
                   & \rotatebox{90}{$\in$} &                 & \rotatebox{90}{$\in$} \\
                   & c(i,j)                & \longmapsto     & c_{i,j}
    \end{array}
  \end{equation}

  \vskip\baselineskip
  \begin{equation}
    \begin{array}{rccc}
      \bm{h}\colon & \{h(i,j)\}            & \longrightarrow & \mathbb{H}            \\
                   & \rotatebox{90}{$\in$} &                 & \rotatebox{90}{$\in$} \\
                   & h(i,j)                & \longmapsto     & h_{i,j}
    \end{array}
  \end{equation}

  \vskip\baselineskip
  \begin{equation}
    \begin{array}{rccc}
      \bm{v}\colon & \{v(i,j)\}            & \longrightarrow & \mathbb{V}            \\
                   & \rotatebox{90}{$\in$} &                 & \rotatebox{90}{$\in$} \\
                   & v(i,j)                & \longmapsto     & v_{i,j}
    \end{array}
  \end{equation}


\end{definition}
\vskip\baselineskip

集合論の用語を借りれば，(例として$\bm{h}$を用いる)列$\{h_{1,1}, h_{1,2},...,h_{i-1,j}\}(以下\{h_{i,j}\}とする)$と写像$\bm{h}\colon \{h(i,j)\} \longrightarrow \mathbb{H}$の間には$\bm{h}(h(i,j))=h_{ij}$という自然な一対一対応が存在し，写像$\bm{h}$は$\{h(i,j)\}$によって添え字付けられた族であり，この時$\{h(i,j)\}$は添字集合で，$h(i,j)$はこの写像の添字である．

未完成盤面において，解答者にこれら写像の中で，盤面上の変数とcodomainの元との対応が公開されていないものを未知情報と呼び，公開されているもの及び解答者が論理的推測により導いたものを既知情報と呼ぶこととする．

盤面上の変数とその解(列の元)の対応は(定義\ref{definition:Mapping})のように添字によってラベル付けされ，実際に取る値の如何に関わらず別物として扱う．盤面上の変数と，その解(定義\ref{definition:Mapping})との対応が全て分かっているとき，写像はそれらの取る値を全て列として記述すれば
\begin{equation*}
  \bm{h}\Leftrightarrow \{h_{i,j}\}
\end{equation*}
と同一視することができる．

このような座標系と種々の定義を導入することにより，(パズルルールを与えず)codomainとして$\mathbb{P},\mathbb{C},\mathbb{H},\mathbb{V}$を与えたとき任意の盤面は
\begin{equation}\label{equation:U}
  U=\Bigl\{\{\bm{c},\bm{p},\bm{h},\bm{v}\}\Bigr\}=\biggl\{\Bigl\{\{c_{i,j}\},\{p_{i,j}\},\{h_{i,j}\},\{v_{i,j}\}\Bigr\}\biggr\}
\end{equation}


なる集合の一つの元と言うことが出来る.ただし，写像$\bm{c}$などは各盤面においてただ一つあるものだから，ある盤面は$\{\bm{c},\bm{p},\bm{h},\bm{v}\}$と記述されることに注意する．

ここで，ある問題を与えたとき完成盤面が満たしているべきパズルルールによって定められた条件は，そのまま(式\ref{equation:U})に条件として記述することができて，これをconditionsと呼ぶこととする．
\begin{definition}\label{definition:Conditions}\textup{\textbf{conditions}}

  あるパズルルールが存在するとき，完成盤面が満たしているべき必要十分条件
\end{definition}

上のconditionsを用いればあるパズルルールが存在した時、完成盤面全体の集合Xは

\begin{equation}
  X=\biggl\{\Bigl\{\{c_{ij}\},\{p_{ij}\},\{h_{ij}\},\{v_{ij}\}\Bigr\}\mid \rm{conditions}\biggr\}
\end{equation}

と記述することができる。



\vskip\baselineskip

\subsection{パズルルールの定義}
前節で定義した用語を用いることによってペンシルパズルにおけるパズルルールという用語の定義を行う．
ペンシルパズルにおけるパズルルールとは完成盤面における全ての既知情報が満たしているべき必要十分条件(conditions)と，その既知情報が取りうる値の範囲(codomain)，そして解答者に向けて隠される情報(Hide Information, 以下HI)の組み合わせである．それぞれが
